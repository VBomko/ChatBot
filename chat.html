<html>
<style type='text/css'>
	/* ===== INITIAL HELP BUTTON STYLES ===== */
	.embeddedServiceHelpButton .helpButton .uiButton { 
		background-color: #E91E63 !important; /* Pink background */
		font-family: "Arial", sans-serif;
		border-radius: 16px !important; /* Rounded square shape */
		width: 60px !important;
		height: 60px !important;
		min-width: 60px !important;
		min-height: 60px !important;
		border: none !important;
		box-shadow: 0 4px 12px rgba(233, 30, 99, 0.4) !important;
		transition: all 0.3s ease !important;
		padding: 0 !important;
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		position: relative !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton:hover {
		background-color: #E91E63 !important; /* Keep same pink color */
		transform: scale(1.1) !important; /* Scale up effect */
		box-shadow: 0 6px 16px rgba(233, 30, 99, 0.6) !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton:focus {
		outline: none !important;
		background-color: #E91E63 !important;
		transform: scale(1.1) !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton:active {
		background-color: #E91E63 !important;
		transform: scale(1.05) !important;
	}

	/* Hide all default content */
	.embeddedServiceHelpButton .helpButton .uiButton * {
		display: none !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton .helpButtonLabel,
	.embeddedServiceHelpButton .helpButton .uiButton .message,
	.embeddedServiceHelpButton .helpButton .uiButton .helpButtonLabel__text {
		display: none !important;
	}

	/* Megaport logo for initial button - normal state */
	.embeddedServiceHelpButton .helpButton .uiButton:before {
		content: "" !important;
		position: absolute !important;
		top: 50% !important;
		left: 50% !important;
		transform: translate(-50%, -50%) !important;
		width: 32px !important;
		height: 32px !important;
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		background-size: 24px 24px !important;
		background-repeat: no-repeat !important;
		background-position: center !important;
		border-radius: 50% !important;
		z-index: 10 !important;
		filter: none !important;
		opacity: 1 !important;
		transition: opacity 0.3s ease !important;
	}

	/* Loading dots animation keyframes - defined first for better compatibility */
	@keyframes loadingDotsAnimation {
		0% {
			background: white !important;
			box-shadow: 
				14px 0 0 rgba(255, 255, 255, 0.3),
				-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		}
		33% {
			background: rgba(255, 255, 255, 0.3) !important;
			box-shadow: 
				14px 0 0 white,
				-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		}
		66% {
			background: rgba(255, 255, 255, 0.3) !important;
			box-shadow: 
				14px 0 0 rgba(255, 255, 255, 0.3),
				-14px 0 0 white !important;
		}
		100% {
			background: white !important;
			box-shadow: 
				14px 0 0 rgba(255, 255, 255, 0.3),
				-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		}
	}

	/* Loading state - hide logo */
	.embeddedServiceHelpButton.loading .helpButton .uiButton:before,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:before {
		opacity: 0 !important;
		display: none !important;
	}

	/* Show loading dots - with multiple selectors for reliability */
	.embeddedServiceHelpButton.loading .helpButton .uiButton:after,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:after {
		content: "" !important;
		position: absolute !important;
		top: 50% !important;
		left: 50% !important;
		transform: translate(-50%, -50%) !important;
		width: 8px !important;
		height: 8px !important;
		border-radius: 50% !important;
		background: white !important;
		box-shadow: 
			14px 0 0 rgba(255, 255, 255, 0.3),
			-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		z-index: 11 !important;
		animation: loadingDotsAnimation 1.2s infinite ease-in-out !important;
		display: block !important;
	}

	/* Ensure no animation when not loading */
	.embeddedServiceHelpButton:not(.loading) .helpButton .uiButton:after,
	.embeddedServiceHelpButton:not([data-loading="true"]) .helpButton .uiButton:after {
		display: none !important;
		animation: none !important;
	}

	/* Logo hover states for initial button */
	.embeddedServiceHelpButton .helpButton .uiButton:hover:before,
	.embeddedServiceHelpButton .helpButton .uiButton:focus:before {
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		filter: none !important;
		opacity: 1 !important;
		mix-blend-mode: normal !important;
	}

	/* Don't show hover logo when loading */
	.embeddedServiceHelpButton.loading .helpButton .uiButton:hover:before,
	.embeddedServiceHelpButton.loading .helpButton .uiButton:focus:before,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:hover:before,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:focus:before {
		opacity: 0 !important;
		display: none !important;
	}

	/* Position the initial button */
	.embeddedServiceHelpButton {
		bottom: 20px !important;
		right: 20px !important;
		z-index: 1000 !important;
		position: fixed !important;
	}

	.embeddedServiceHelpButton .helpButton {
		width: 60px !important;
		height: 60px !important;
		border-radius: 16px !important;
		overflow: hidden !important;
	}

	/* ===== MINIMIZED CHAT BUTTON STYLES ===== */
	.minimizedContainer,
	button.minimizedContainer,
	.minimizedContainer:not(.slds-hidden),
	:host .minimizedContainer,
	.embeddedServiceSidebar .minimizedContainer,
	.embeddedServiceSidebar button.minimizedContainer,
	.embeddedServiceSidebar .dockableContainer .minimizedContainer {
		position: fixed !important;
		left: auto !important;
		bottom: 20px !important;
		right: 20px !important;
		margin: 0 !important;
		width: 60px !important;
		height: 60px !important;
		min-width: 60px !important;
		max-width: 60px !important;
		min-height: 60px !important;
		max-height: 60px !important;
		border-radius: 16px !important;
		text-align: center !important;
		text-decoration: none !important;
		box-shadow: 0 4px 12px rgba(233, 30, 99, 0.4) !important;
		pointer-events: all !important;
		overflow: visible !important;
		background: #E91E63 !important;
		border: none !important;
		cursor: pointer !important;
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		flex-direction: column !important;
		transition: all 0.3s ease !important;
		font-size: 16px !important;
		padding: 0 !important;
		color: white !important;
		z-index: 1000 !important;
		transform: none !important;
		top: auto !important;
	}

	/* Force positioning override with even higher specificity */
	body .minimizedContainer,
	body button.minimizedContainer,
	body :host .minimizedContainer,
	body .embeddedServiceSidebar .minimizedContainer,
	body .embeddedServiceSidebar button.minimizedContainer {
		bottom: 20px !important;
		right: 20px !important;
		top: auto !important;
		left: auto !important;
		position: fixed !important;
	}

	/* Hover effects for minimized button */
	.minimizedContainer:focus,
	.minimizedContainer:hover,
	button.minimizedContainer:focus,
	button.minimizedContainer:hover,
	:host .minimizedContainer:focus,
	:host .minimizedContainer:hover,
	.embeddedServiceSidebar .minimizedContainer:hover,
	.embeddedServiceSidebar button.minimizedContainer:hover {
		transform: scale(1.1) !important;
		box-shadow: 0 6px 16px rgba(233, 30, 99, 0.6) !important;
		outline: none !important;
		background: #E91E63 !important;
		bottom: 20px !important;
		right: 20px !important;
	}

	/* Hide all content in minimized button */
	.minimizedContainer *,
	:host .minimizedContainer *,
	.minimizedContainer .chat-icon,
	.minimizedContainer .chat-bubble,
	.minimizedContainer .chat-lines,
	.minimizedContainer .line,
	.minimizedContainer .messageContent,
	.embeddedServiceSidebar .minimizedContainer *,
	.embeddedServiceSidebar .minimizedContainer .minimizedText,
	.embeddedServiceSidebar .minimizedContainer .message {
		display: none !important;
	}

	/* Add Megaport logo to minimized button */
	.minimizedContainer:before,
	:host .minimizedContainer:before,
	.embeddedServiceSidebar .minimizedContainer:before {
		content: "" !important;
		position: absolute !important;
		top: 50% !important;
		left: 50% !important;
		transform: translate(-50%, -50%) !important;
		width: 32px !important;
		height: 32px !important;
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		background-size: 24px 24px !important;
		background-repeat: no-repeat !important;
		background-position: center !important;
		border-radius: 50% !important;
		z-index: 10 !important;
		filter: none !important;
		opacity: 1 !important;
	}

	/* Logo hover states for minimized button */
	.minimizedContainer:hover:before,
	.minimizedContainer:focus:before,
	:host .minimizedContainer:hover:before,
	:host .minimizedContainer:focus:before,
	.embeddedServiceSidebar .minimizedContainer:hover:before {
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		filter: none !important;
		opacity: 1 !important;
		mix-blend-mode: normal !important;
	}

	/* ===== MOBILE RESPONSIVE STYLES ===== */
	@media screen and (max-width: 768px) {
		.embeddedServiceHelpButton .helpButton .uiButton {
			width: 50px !important;
			height: 50px !important;
			min-width: 50px !important;
			min-height: 50px !important;
			border-radius: 14px !important;
		}
		
		.embeddedServiceHelpButton .helpButton {
			width: 50px !important;
			height: 50px !important;
			border-radius: 14px !important;
		}
		
		.embeddedServiceHelpButton .helpButton .uiButton:before {
			width: 26px !important;
			height: 26px !important;
			background-size: 20px 20px !important;
		}

		/* Mobile loading dots */
		.embeddedServiceHelpButton.loading .helpButton .uiButton:after,
		.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:after {
			width: 6px !important;
			height: 6px !important;
			box-shadow: 
				10px 0 0 rgba(255, 255, 255, 0.3),
				-10px 0 0 rgba(255, 255, 255, 0.3) !important;
		}

		/* Mobile animation keyframes */
		@keyframes loadingDotsAnimation {
			0% {
				background: white !important;
				box-shadow: 
					10px 0 0 rgba(255, 255, 255, 0.3),
					-10px 0 0 rgba(255, 255, 255, 0.3) !important;
			}
			33% {
				background: rgba(255, 255, 255, 0.3) !important;
				box-shadow: 
					10px 0 0 white,
					-10px 0 0 rgba(255, 255, 255, 0.3) !important;
			}
			66% {
				background: rgba(255, 255, 255, 0.3) !important;
				box-shadow: 
					10px 0 0 rgba(255, 255, 255, 0.3),
					-10px 0 0 white !important;
			}
			100% {
				background: white !important;
				box-shadow: 
					10px 0 0 rgba(255, 255, 255, 0.3),
					-10px 0 0 rgba(255, 255, 255, 0.3) !important;
			}
		}
		
		.minimizedContainer,
		button.minimizedContainer,
		:host .minimizedContainer,
		.embeddedServiceSidebar .minimizedContainer {
			width: 50px !important;
			height: 50px !important;
			min-width: 50px !important;
			min-height: 50px !important;
			max-width: 50px !important;
			max-height: 50px !important;
			border-radius: 14px !important;
			bottom: 20px !important;
			right: 20px !important;
		}
		
		.minimizedContainer:before,
		:host .minimizedContainer:before,
		.embeddedServiceSidebar .minimizedContainer:before {
			width: 26px !important;
			height: 26px !important;
			background-size: 20px 20px !important;
		}
		
		.embeddedServiceHelpButton {
			bottom: 20px !important;
			right: 20px !important;
		}
	}

	/* Hide chat input initially */
	.chasitorText {
        display: none !important;
    }

	/* ===== RESTART BUTTON STYLES ===== */
	.restart-chat-button {
		background-color: #E91E63 !important;
		color: white !important;
		border: none !important;
		border-radius: 8px !important;
		padding: 10px 20px !important;
		font-size: 14px !important;
		font-weight: 600 !important;
		cursor: pointer !important;
		transition: all 0.3s ease !important;
		margin: 10px auto !important;
		display: block !important;
		width: calc(100% - 20px) !important;
		max-width: 200px !important;
		box-shadow: 0 2px 8px rgba(233, 30, 99, 0.3) !important;
	}

	.restart-chat-button:hover {
		background-color: #C2185B !important;
		box-shadow: 0 4px 12px rgba(233, 30, 99, 0.5) !important;
		transform: translateY(-2px) !important;
	}

	.restart-chat-button:active {
		transform: translateY(0px) !important;
		box-shadow: 0 2px 6px rgba(233, 30, 99, 0.3) !important;
	}

	/* Position restart button in footer */
	.embeddedServiceSidebarFooter {
		position: relative !important;
		padding-bottom: 60px !important;
	}

	.restart-button-container {
		position: absolute !important;
		bottom: 10px !important;
		left: 0 !important;
		right: 0 !important;
		padding: 0 10px !important;
		z-index: 1000 !important;
	}

	
</style>

<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script type='text/javascript'>
	// Function to get device type based on screen width
	function getDeviceType() {
		var screenWidth = window.innerWidth;
		if (screenWidth <= 768) return 'mobile';
		if (screenWidth <= 1024) return 'tablet';
		return 'desktop';
	}

	// Function to add restart button to chat footer
	function addRestartButton() {
		setTimeout(function() {
			var footer = document.querySelector('.chasitorControls');
			console.log('chasitorControls' , footer );
			// Check if button already exists
			if (footer && !document.querySelector('.restart-button-container')) {
				var buttonContainer = document.createElement('div');
				buttonContainer.className = 'restart-button-container';
				
				var restartButton = document.createElement('button');
				restartButton.className = 'restart-chat-button';
				restartButton.textContent = 'Restart Chat';
				restartButton.setAttribute('aria-label', 'Restart chat conversation');
				
				restartButton.addEventListener('click', function() {
					console.log('Restart button clicked - will restart chat session');
					// TODO: Add actual restart functionality here
						console.log('Returning to main menu...');
	
							try {
								// Use the Embedded Service API to return to pre-chat state
								if (embedded_svc && embedded_svc.showPrechat) {
									embedded_svc.showPrechat();
								} else if (embedded_svc && embedded_svc.menu) {
									// Alternative: Show the menu
									embedded_svc.menu.showMenu();
								}
							} catch (error) {
								console.error('Error returning to main menu:', error);
							}
				});
				
				buttonContainer.appendChild(restartButton);
				footer.appendChild(buttonContainer);
			}
		}, 500);
	}
	
	// Function to set widget dimensions based on device type
	function setWidgetDimensions(deviceType) {
		if (!embedded_svc || !embedded_svc.settings) return;

		switch(deviceType) {
			case 'mobile':
				embedded_svc.settings.widgetWidth = "100%";
				embedded_svc.settings.widgetHeight = "90%";
				break;
			case 'tablet':
				embedded_svc.settings.widgetWidth = "350px";
				embedded_svc.settings.widgetHeight = "500px";
				break;
			case 'desktop':
			default:
				embedded_svc.settings.widgetWidth = "400px";
				embedded_svc.settings.widgetHeight = "800px";
				break;
		}
	}

	// Function to apply CSS changes for responsive behavior
	function applyCSSChanges(deviceType) {
		var chatContainer = document.querySelector('.embeddedServiceSidebar .dockableContainer');
		
		if (chatContainer) {
			switch(deviceType) {
				case 'mobile':
					chatContainer.style.width = '100vw';
					chatContainer.style.height = '90vh';
					chatContainer.style.left = '0';
					chatContainer.style.bottom = '0';
					break;
				case 'tablet':
					chatContainer.style.width = '350px';
					chatContainer.style.height = '500px';
					chatContainer.style.left = '';
					chatContainer.style.bottom = '';
					break;
				case 'desktop':
				default:
					chatContainer.style.width = '400px';
					chatContainer.style.height = '800px';
					chatContainer.style.left = '';
					chatContainer.style.bottom = '';
					break;
			}
		}
	}

	// Function to fix button styling after it loads
	function fixButtonStyling() {
		setTimeout(function() {
			var button = document.querySelector('.embeddedServiceHelpButton .helpButton .uiButton');
			var helpButton = document.querySelector('.embeddedServiceHelpButton');
			
			if (button) {
				// Force circular shape
				button.style.borderRadius = '50%';
				button.style.width = '60px';
				button.style.height = '60px';
				button.style.minWidth = '60px';
				button.style.minHeight = '60px';
				button.style.padding = '0';
				button.style.display = 'flex';
				button.style.alignItems = 'center';
				button.style.justifyContent = 'center';
				
				// Hide any text content
				var textElements = button.querySelectorAll('*');
				textElements.forEach(function(el) {
					el.style.display = 'none';
				});
			}

			// Ensure consistent positioning across all devices
			if (helpButton) {
				helpButton.style.bottom = '20px';
				helpButton.style.right = '20px';
			}
		}, 100);
	}

	
	// Enhanced function to trigger loading animation
	function startLoadingAnimation() {
		var helpButton = document.querySelector('.embeddedServiceHelpButton');
		if (helpButton) {
			helpButton.classList.add('loading');
			helpButton.setAttribute('data-loading', 'true');
			console.log('Loading animation started');
		}
	}

	// Enhanced function to stop loading animation
	function stopLoadingAnimation() {
		var helpButton = document.querySelector('.embeddedServiceHelpButton');
		if (helpButton) {
			helpButton.classList.remove('loading');
			helpButton.removeAttribute('data-loading');
			console.log('Loading animation stopped');
		}
	}
	
	var initESW = function(gslbBaseURL) { 
		embedded_svc.settings.displayHelpButton = true; //Or false
		embedded_svc.settings.language = ''; //For example, enter 'en' or 'en-US'
		
		embedded_svc.settings.loadingText = 'Connecting to support...'; // Custom loading message
		embedded_svc.settings.chatbotAvatarImgURL = "https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG";

		// Set initial dimensions
		var currentDeviceType = getDeviceType();
		setWidgetDimensions(currentDeviceType);

		// Store current device type for comparison
		var lastDeviceType = currentDeviceType;

		// Resize event handler with debouncing
		var resizeTimeout;
		function handleResize() {
			clearTimeout(resizeTimeout);
			resizeTimeout = setTimeout(function() {
				var newDeviceType = getDeviceType();
				
				// Only update if device type actually changed
				if (newDeviceType !== lastDeviceType) {
					console.log('Device type changed from', lastDeviceType, 'to', newDeviceType);
					
					// Update settings
					setWidgetDimensions(newDeviceType);
					
					// Apply CSS changes to existing chat window
					applyCSSChanges(newDeviceType);
					
					// Update stored device type
					lastDeviceType = newDeviceType;
					
					// Trigger a refresh of the chat widget if it's open
					var chatContainer = document.querySelector('.embeddedServiceSidebar');
					if (chatContainer && chatContainer.style.display !== 'none') {
						// Force a re-render by toggling visibility briefly
						chatContainer.style.visibility = 'hidden';
						setTimeout(function() {
							chatContainer.style.visibility = 'visible';
						}, 50);
					}
				} else {
					// Even if device type didn't change, apply CSS for minor adjustments
					applyCSSChanges(newDeviceType);
				}
			}, 250); // 250ms debounce delay
		}

		// Add resize event listener
		window.addEventListener('resize', handleResize);

		// Add orientation change listener for mobile devices
		window.addEventListener('orientationchange', function() {
			setTimeout(handleResize, 100); // Small delay to let orientation change complete
		});

		embedded_svc.addEventHandler("onHelpButtonClick", function(data) {
			startLoadingAnimation();
			fixButtonStyling();
		});
		
		embedded_svc.addEventHandler("onChatEstablished", function(data) {
			stopLoadingAnimation();

		    // Live agent connected → show input
		    var chasitorText = document.querySelector('.chasitorText');
		    if (chasitorText) {
		        chasitorText.style.display = "block";
		    }
			// Apply responsive styling when chat opens
		    setTimeout(function() {
		    	applyCSSChanges(getDeviceType());
		    }, 100);
			addRestartButton();
		});
		
		embedded_svc.addEventHandler("onChatEnded", function(data) {
		    // Chat ended → hide input
		    var chasitorText = document.querySelector('.chasitorText');
		    if (chasitorText) {
		        chasitorText.style.display = "none";
		    }
		});

		// Apply responsive styling when sidebar loads
		embedded_svc.addEventHandler("onSidebarLoaded", function(data) {
			stopLoadingAnimation();
			setTimeout(function() {
				applyCSSChanges(getDeviceType());
				addRestartButton();
			}, 100);
		});

		// Fix button styling when it first loads
		embedded_svc.addEventHandler("onHelpButtonLoaded", function(data) {
			fixButtonStyling();
		});

		// Additional event handlers to ensure animation stops
		embedded_svc.addEventHandler("onChatStarted", function(data) {
			console.log('Chat started - stopping animation');
			stopLoadingAnimation();
			addRestartButton();
		});

		embedded_svc.addEventHandler("onAgentJoined", function(data) {
			console.log('Agent joined - stopping animation');
			stopLoadingAnimation();
		});
		
		//embedded_svc.settings.defaultMinimizedText = '...'; //(Defaults to Chat with an Expert)
		//embedded_svc.settings.disabledMinimizedText = '...'; //(Defaults to Agent Offline)

		//embedded_svc.settings.loadingText = ''; //(Defaults to Loading)
		//embedded_svc.settings.storageDomain = 'yourdomain.com'; //(Sets the domain for your deployment so that visitors can navigate subdomains during a chat session)

		// Settings for Chat
		//embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
			// Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
			// Returns a valid button ID.
		//};
		//embedded_svc.settings.prepopulatedPrechatFields = {}; //Sets the auto-population of pre-chat form fields
		//embedded_svc.settings.fallbackRouting = []; //An array of button IDs, user IDs, or userId_buttonId
		//embedded_svc.settings.offlineSupportMinimizedText = '...'; //(Defaults to Contact Us)

		embedded_svc.settings.enabledFeatures = ['LiveAgent'];
		embedded_svc.settings.entryFeature = 'LiveAgent';

		embedded_svc.init(
			'https://megaport--peeklogicd.sandbox.my.salesforce.com',
			'https://megaport--peeklogicd.sandbox.my.site.com/BotTesting',
			gslbBaseURL,
			'00DH30000000naQ',
			'Support_queue',
			{
				baseLiveAgentContentURL: 'https://c.la12s-core1.sfdc-vwfla6.salesforceliveagent.com/content',
				deploymentId: '5726F000000HVqE',
				buttonId: '5739n000000dMIP',
				baseLiveAgentURL: 'https://d.la12s-core1.sfdc-vwfla6.salesforceliveagent.com/chat',
				eswLiveAgentDevName: 'Support_queue',
				isOfflineSupportEnabled: true
			}
		);

	};

	if (!window.embedded_svc) {
		var s = document.createElement('script');
		s.setAttribute('src', 'https://megaport--peeklogicd.sandbox.my.salesforce.com/embeddedservice/5.0/esw.min.js');
		s.onload = function() {
			initESW(null);
		};
		document.body.appendChild(s);
	} else {
		initESW('https://service.force.com');
	}
</script>
</html>
