<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Megaport Embedded Chat</title>

<style type='text/css'>
	/* ===== INITIAL HELP BUTTON STYLES (UNCHANGED) ===== */
	.embeddedServiceHelpButton .helpButton .uiButton { 
		background-color: #E91E63 !important; /* Pink background */
		font-family: "Arial", sans-serif;
		border-radius: 16px !important; /* Rounded square shape */
		width: 60px !important;
		height: 60px !important;
		min-width: 60px !important;
		min-height: 60px !important;
		border: none !important;
		box-shadow: 0 4px 12px rgba(233, 30, 99, 0.4) !important;
		transition: all 0.3s ease !important;
		padding: 0 !important;
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		position: relative !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton:hover {
		background-color: #E91E63 !important; /* Keep same pink color */
		transform: scale(1.1) !important; /* Scale up effect */
		box-shadow: 0 6px 16px rgba(233, 30, 99, 0.6) !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton:focus {
		outline: none !important;
		background-color: #E91E63 !important;
		transform: scale(1.1) !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton:active {
		background-color: #E91E63 !important;
		transform: scale(1.05) !important;
	}

	/* Hide all default content */
	.embeddedServiceHelpButton .helpButton .uiButton * {
		display: none !important;
	}

	.embeddedServiceHelpButton .helpButton .uiButton .helpButtonLabel,
	.embeddedServiceHelpButton .helpButton .uiButton .message,
	.embeddedServiceHelpButton .helpButton .uiButton .helpButtonLabel__text {
		display: none !important;
	}

	/* Megaport logo for initial button - normal state */
	.embeddedServiceHelpButton .helpButton .uiButton:before {
		content: "" !important;
		position: absolute !important;
		top: 50% !important;
		left: 50% !important;
		transform: translate(-50%, -50%) !important;
		width: 32px !important;
		height: 32px !important;
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		background-size: 24px 24px !important;
		background-repeat: no-repeat !important;
		background-position: center !important;
		border-radius: 50% !important;
		z-index: 10 !important;
		filter: none !important;
		opacity: 1 !important;
		transition: opacity 0.3s ease !important;
	}

	/* Loading dots animation keyframes - defined first for better compatibility */
	@keyframes loadingDotsAnimation {
		0% {
			background: white !important;
			box-shadow: 
				14px 0 0 rgba(255, 255, 255, 0.3),
				-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		}
		33% {
			background: rgba(255, 255, 255, 0.3) !important;
			box-shadow: 
				14px 0 0 white,
				-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		}
		66% {
			background: rgba(255, 255, 255, 0.3) !important;
			box-shadow: 
				14px 0 0 rgba(255, 255, 255, 0.3),
				-14px 0 0 white !important;
		}
		100% {
			background: white !important;
			box-shadow: 
				14px 0 0 rgba(255, 255, 255, 0.3),
				-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		}
	}

	/* Loading state - hide logo */
	.embeddedServiceHelpButton.loading .helpButton .uiButton:before,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:before {
		opacity: 0 !important;
		display: none !important;
	}

	/* Show loading dots - with multiple selectors for reliability */
	.embeddedServiceHelpButton.loading .helpButton .uiButton:after,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:after {
		content: "" !important;
		position: absolute !important;
		top: 50% !important;
		left: 50% !important;
		transform: translate(-50%, -50%) !important;
		width: 8px !important;
		height: 8px !important;
		border-radius: 50% !important;
		background: white !important;
		box-shadow: 
			14px 0 0 rgba(255, 255, 255, 0.3),
			-14px 0 0 rgba(255, 255, 255, 0.3) !important;
		z-index: 11 !important;
		animation: loadingDotsAnimation 1.2s infinite ease-in-out !important;
		display: block !important;
	}

	/* Ensure no animation when not loading */
	.embeddedServiceHelpButton:not(.loading) .helpButton .uiButton:after,
	.embeddedServiceHelpButton:not([data-loading="true"]) .helpButton .uiButton:after {
		display: none !important;
		animation: none !important;
	}

	/* Logo hover states for initial button */
	.embeddedServiceHelpButton .helpButton .uiButton:hover:before,
	.embeddedServiceHelpButton .helpButton .uiButton:focus:before {
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		filter: none !important;
		opacity: 1 !important;
		mix-blend-mode: normal !important;
	}

	/* Don't show hover logo when loading */
	.embeddedServiceHelpButton.loading .helpButton .uiButton:hover:before,
	.embeddedServiceHelpButton.loading .helpButton .uiButton:focus:before,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:hover:before,
	.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:focus:before {
		opacity: 0 !important;
		display: none !important;
	}

	/* Position the initial button */
	.embeddedServiceHelpButton {
		bottom: 20px !important;
		right: 20px !important;
		z-index: 1000 !important;
		position: fixed !important;
	}

	.embeddedServiceHelpButton .helpButton {
		width: 60px !important;
		height: 60px !important;
		border-radius: 16px !important;
		overflow: hidden !important;
	}

	/* ===== MINIMIZED CHAT BUTTON STYLES (UNCHANGED) ===== */
	.minimizedContainer,
	button.minimizedContainer,
	.minimizedContainer:not(.slds-hidden),
	:host .minimizedContainer,
	.embeddedServiceSidebar .minimizedContainer,
	.embeddedServiceSidebar button.minimizedContainer,
	.embeddedServiceSidebar .dockableContainer .minimizedContainer {
		position: fixed !important;
		left: auto !important;
		bottom: 20px !important;
		right: 20px !important;
		margin: 0 !important;
		width: 60px !important;
		height: 60px !important;
		min-width: 60px !important;
		max-width: 60px !important;
		min-height: 60px !important;
		max-height: 60px !important;
		border-radius: 16px !important;
		text-align: center !important;
		text-decoration: none !important;
		box-shadow: 0 4px 12px rgba(233, 30, 99, 0.4) !important;
		pointer-events: all !important;
		overflow: visible !important;
		background: #E91E63 !important;
		border: none !important;
		cursor: pointer !important;
		display: flex !important;
		align-items: center !important;
		justify-content: center !important;
		flex-direction: column !important;
		transition: all 0.3s ease !important;
		font-size: 16px !important;
		padding: 0 !important;
		color: white !important;
		z-index: 1000 !important;
		transform: none !important;
		top: auto !important;
	}

	/* Force positioning override with even higher specificity */
	body .minimizedContainer,
	body button.minimizedContainer,
	body :host .minimizedContainer,
	body .embeddedServiceSidebar .minimizedContainer,
	body .embeddedServiceSidebar button.minimizedContainer {
		bottom: 20px !important;
		right: 20px !important;
		top: auto !important;
		left: auto !important;
		position: fixed !important;
	}

	/* Hover effects for minimized button */
	.minimizedContainer:focus,
	.minimizedContainer:hover,
	button.minimizedContainer:focus,
	button.minimizedContainer:hover,
	:host .minimizedContainer:focus,
	:host .minimizedContainer:hover,
	.embeddedServiceSidebar .minimizedContainer:hover,
	.embeddedServiceSidebar button.minimizedContainer:hover {
		transform: scale(1.1) !important;
		box-shadow: 0 6px 16px rgba(233, 30, 99, 0.6) !important;
		outline: none !important;
		background: #E91E63 !important;
		bottom: 20px !important;
		right: 20px !important;
	}

	/* Hide all content in minimized button */
	.minimizedContainer *,
	:host .minimizedContainer *,
	.minimizedContainer .chat-icon,
	.minimizedContainer .chat-bubble,
	.minimizedContainer .chat-lines,
	.minimizedContainer .line,
	.minimizedContainer .messageContent,
	.embeddedServiceSidebar .minimizedContainer *,
	.embeddedServiceSidebar .minimizedContainer .minimizedText,
	.embeddedServiceSidebar .minimizedContainer .message {
		display: none !important;
	}

	/* Add Megaport logo to minimized button */
	.minimizedContainer:before,
	:host .minimizedContainer:before,
	.embeddedServiceSidebar .minimizedContainer:before {
		content: "" !important;
		position: absolute !important;
		top: 50% !important;
		left: 50% !important;
		transform: translate(-50%, -50%) !important;
		width: 32px !important;
		height: 32px !important;
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		background-size: 24px 24px !important;
		background-repeat: no-repeat !important;
		background-position: center !important;
		border-radius: 50% !important;
		z-index: 10 !important;
		filter: none !important;
		opacity: 1 !important;
	}

	/* Logo hover states for minimized button */
	.minimizedContainer:hover:before,
	.minimizedContainer:focus:before,
	:host .minimizedContainer:hover:before,
	:host .minimizedContainer:focus:before,
	.embeddedServiceSidebar .minimizedContainer:hover:before {
		background-color: white !important;
		background-image: url("https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG") !important;
		filter: none !important;
		opacity: 1 !important;
		mix-blend-mode: normal !important;
	}

	/* ===== MOBILE RESPONSIVE STYLES (UNCHANGED) ===== */
	@media screen and (max-width: 768px) {
		.embeddedServiceHelpButton .helpButton .uiButton {
			width: 50px !important;
			height: 50px !important;
			min-width: 50px !important;
			min-height: 50px !important;
			border-radius: 14px !important;
		}
		
		.embeddedServiceHelpButton .helpButton {
			width: 50px !important;
			height: 50px !important;
			border-radius: 14px !important;
		}
		
		.embeddedServiceHelpButton .helpButton .uiButton:before {
			width: 26px !important;
			height: 26px !important;
			background-size: 20px 20px !important;
		}

		/* Mobile loading dots */
		.embeddedServiceHelpButton.loading .helpButton .uiButton:after,
		.embeddedServiceHelpButton[data-loading="true"] .helpButton .uiButton:after {
			width: 6px !important;
			height: 6px !important;
			box-shadow: 
				10px 0 0 rgba(255, 255, 255, 0.3),
				-10px 0 0 rgba(255, 255, 255, 0.3) !important;
		}

		/* Mobile animation keyframes */
		@keyframes loadingDotsAnimation {
			0% {
				background: white !important;
				box-shadow: 
					10px 0 0 rgba(255, 255, 255, 0.3),
					-10px 0 0 rgba(255, 255, 255, 0.3) !important;
			}
			33% {
				background: rgba(255, 255, 255, 0.3) !important;
				box-shadow: 
					10px 0 0 white,
					-10px 0 0 rgba(255, 255, 255, 0.3) !important;
			}
			66% {
				background: rgba(255, 255, 255, 0.3) !important;
				box-shadow: 
					10px 0 0 rgba(255, 255, 255, 0.3),
					-10px 0 0 white !important;
			}
			100% {
				background: white !important;
				box-shadow: 
					10px 0 0 rgba(255, 255, 255, 0.3),
					-10px 0 0 rgba(255, 255, 255, 0.3) !important;
			}
		}
		
		.minimizedContainer,
		button.minimizedContainer,
		:host .minimizedContainer,
		.embeddedServiceSidebar .minimizedContainer {
			width: 50px !important;
			height: 50px !important;
			min-width: 50px !important;
			min-height: 50px !important;
			max-width: 50px !important;
			max-height: 50px !important;
			border-radius: 14px !important;
			bottom: 20px !important;
			right: 20px !important;
		}
		
		.minimizedContainer:before,
		:host .minimizedContainer:before,
		.embeddedServiceSidebar .minimizedContainer:before {
			width: 26px !important;
			height: 26px !important;
			background-size: 20px 20px !important;
		}
		
		.embeddedServiceHelpButton {
			bottom: 20px !important;
			right: 20px !important;
		}
	}

	/* Hide chat input initially */
	.chasitorText { display: none !important; }

	/* ===== CUSTOM FOOTER OVERRIDE (NEW) ===== */
	/* Hide platform footer so only our footer shows on first page */
	.embeddedServiceSidebar .footer,
	.embeddedServiceSidebar .dockableFooter {
		display: none !important;
	}

	/* Positioning context for custom footer */
	.embeddedServiceSidebar .dockableContainer {
		position: relative !important;
	}

	/* Avoid content being covered by the custom footer */
	.embeddedServiceSidebar .dockableContainer .conversationRegion,
	.embeddedServiceSidebar .dockableContainer .conversation .scrollable,
	.embeddedServiceSidebar .dockableContainer .conversation {
		padding-bottom: 96px !important;
	}

	/* Custom footer UI */
	.meg-custom-footer {
		position: absolute;
		left: 0;
		right: 0;
		bottom: 0;
		padding: 12px 16px 16px;
		background: transparent;
		pointer-events: none;
	}

	.meg-custom-footer__card {
		background: #fff;
		border-radius: 20px 20px 16px 16px;
		box-shadow: 0 6px 24px rgba(0,0,0,0.18);
		padding: 12px;
		max-width: 100%;
		margin: 0 auto;
	}

	.meg-custom-footer__button {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		border: none;
		border-radius: 14px;
		padding: 14px 16px;
		background: #E91E63;
		color: #fff;
		font-weight: 600;
		font-size: 15px;
		cursor: pointer;
		box-shadow: 0 8px 20px rgba(233,30,99,0.35);
		transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
		pointer-events: auto;
	}

	.meg-custom-footer__button:hover,
	.meg-custom-footer__button:focus {
		transform: translateY(-1px);
		box-shadow: 0 10px 24px rgba(233,30,99,0.45);
		outline: none;
	}

	.meg-custom-footer__icon {
		width: 18px;
		height: 18px;
		border: 2px solid rgba(255,255,255,0.9);
		border-radius: 50%;
		margin-right: 10px;
		position: relative;
	}

	.meg-custom-footer__icon:after {
		content: "";
		position: absolute;
		left: 50%;
		top: 50%;
		width: 8px;
		height: 2px;
		background: rgba(255,255,255,0.9);
		transform: translate(-50%, -50%) rotate(45deg);
		border-radius: 1px;
	}

	@media (max-width: 768px) {
		.meg-custom-footer { padding: 10px 12px 12px; }
		.meg-custom-footer__card { border-radius: 18px 18px 14px 14px; }
		.meg-custom-footer__button { border-radius: 12px; padding: 12px 14px; font-size: 14px; }
	}
</style>
</head>

<body>
<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script type='text/javascript'>
	function getDeviceType() {
		var screenWidth = window.innerWidth;
		if (screenWidth <= 768) return 'mobile';
		if (screenWidth <= 1024) return 'tablet';
		return 'desktop';
	}

	function setWidgetDimensions(deviceType) {
		if (!embedded_svc || !embedded_svc.settings) return;

		switch(deviceType) {
			case 'mobile':
				embedded_svc.settings.widgetWidth = "100%";
				embedded_svc.settings.widgetHeight = "90%";
				break;
			case 'tablet':
				embedded_svc.settings.widgetWidth = "350px";
				embedded_svc.settings.widgetHeight = "500px";
				break;
			case 'desktop':
			default:
				embedded_svc.settings.widgetWidth = "400px";
				embedded_svc.settings.widgetHeight = "800px";
				break;
		}
	}

	function applyCSSChanges(deviceType) {
		var chatContainer = document.querySelector('.embeddedServiceSidebar .dockableContainer');
		if (chatContainer) {
			switch(deviceType) {
				case 'mobile':
					chatContainer.style.width = '100vw';
					chatContainer.style.height = '90vh';
					chatContainer.style.left = '0';
					chatContainer.style.bottom = '0';
					break;
				case 'tablet':
					chatContainer.style.width = '350px';
					chatContainer.style.height = '500px';
					chatContainer.style.left = '';
					chatContainer.style.bottom = '';
					break;
				case 'desktop':
				default:
					chatContainer.style.width = '400px';
					chatContainer.style.height = '800px';
					chatContainer.style.left = '';
					chatContainer.style.bottom = '';
					break;
			}
		}
	}

	/* Footer helpers */
	function createCustomFooter() {
		var root = document.createElement('div');
		root.className = 'meg-custom-footer';
		root.innerHTML =
			'<div class="meg-custom-footer__card">' +
				'<button type="button" class="meg-custom-footer__button" id="meg-restart-btn">' +
					'<span class="meg-custom-footer__icon" aria-hidden="true"></span>' +
					'<span>Restart conversation</span>' +
				'</button>' +
			'</div>';
		return root;
	}

	function ensureCustomFooterMounted() {
		var dock = document.querySelector('.embeddedServiceSidebar .dockableContainer');
		if (!dock) return;
		if (!dock.querySelector('.meg-custom-footer')) {
			dock.appendChild(createCustomFooter());
			var btn = dock.querySelector('#meg-restart-btn');
			if (btn) {
				btn.addEventListener('click', function () {
					console.log('[Megaport Chat] Restart conversation clicked');
				});
			}
		}
	}

	function showCustomFooter(show) {
		var el = document.querySelector('.embeddedServiceSidebar .dockableContainer .meg-custom-footer');
		if (el) el.style.display = show ? 'block' : 'none';
	}

	var initESW = function(gslbBaseURL) { 
		embedded_svc.settings.displayHelpButton = true;
		embedded_svc.settings.language = '';
		embedded_svc.settings.loadingText = 'Connecting to support...';
		embedded_svc.settings.chatbotAvatarImgURL = "https://megaport--peeklogicd.sandbox.my.site.com/BotTesting/resource/1758619710000/MegaportLogoSVG";

		var currentDeviceType = getDeviceType();
		setWidgetDimensions(currentDeviceType);
		var lastDeviceType = currentDeviceType;

		var resizeTimeout;
		function handleResize() {
			clearTimeout(resizeTimeout);
			resizeTimeout = setTimeout(function() {
				var newDeviceType = getDeviceType();
				if (newDeviceType !== lastDeviceType) {
					setWidgetDimensions(newDeviceType);
					applyCSSChanges(newDeviceType);
					lastDeviceType = newDeviceType;
					var chatContainer = document.querySelector('.embeddedServiceSidebar');
					if (chatContainer && chatContainer.style.display !== 'none') {
						chatContainer.style.visibility = 'hidden';
						setTimeout(function() { chatContainer.style.visibility = 'visible'; }, 50);
					}
				} else {
					applyCSSChanges(newDeviceType);
				}
			}, 250);
		}

		window.addEventListener('resize', handleResize);
		window.addEventListener('orientationchange', function() {
			setTimeout(handleResize, 100);
		});

		embedded_svc.addEventHandler("onHelpButtonClick", function() {
			/* Keep original styles; no JS overrides */
		});
		
		embedded_svc.addEventHandler("onChatEstablished", function() {
			var chasitorText = document.querySelector('.chasitorText');
			if (chasitorText) { chasitorText.style.display = "block"; }
		    setTimeout(function() {
		    	applyCSSChanges(getDeviceType());
				ensureCustomFooterMounted();
				showCustomFooter(true);
		    }, 100);
		});
		
		embedded_svc.addEventHandler("onChatEnded", function() {
			var chasitorText = document.querySelector('.chasitorText');
			if (chasitorText) { chasitorText.style.display = "none"; }
			showCustomFooter(true);
		});

		embedded_svc.addEventHandler("onSidebarLoaded", function() {
			setTimeout(function() {
				applyCSSChanges(getDeviceType());
				ensureCustomFooterMounted();
				showCustomFooter(true);
			}, 100);
		});

		embedded_svc.addEventHandler("onHelpButtonLoaded", function() {
			/* No help-button style overrides here either */
		});

		embedded_svc.addEventHandler("onChatStarted", function() {});
		embedded_svc.addEventHandler("onAgentJoined", function() {});
		
		embedded_svc.settings.enabledFeatures = ['LiveAgent'];
		embedded_svc.settings.entryFeature = 'LiveAgent';

		embedded_svc.init(
			'https://megaport--peeklogicd.sandbox.my.salesforce.com',
			'https://megaport--peeklogicd.sandbox.my.site.com/BotTesting',
			gslbBaseURL,
			'00DH30000000naQ',
			'Support_queue',
			{
				baseLiveAgentContentURL: 'https://c.la12s-core1.sfdc-vwfla6.salesforceliveagent.com/content',
				deploymentId: '5726F000000HVqE',
				buttonId: '5739n000000dMIP',
				baseLiveAgentURL: 'https://d.la12s-core1.sfdc-vwfla6.salesforceliveagent.com/chat',
				eswLiveAgentDevName: 'Support_queue',
				isOfflineSupportEnabled: true
			}
		);
	};

	if (!window.embedded_svc) {
		var s = document.createElement('script');
		s.setAttribute('src', 'https://megaport--peeklogicd.sandbox.my.salesforce.com/embeddedservice/5.0/esw.min.js');
		s.onload = function() { initESW(null); };
		document.body.appendChild(s);
	} else {
		initESW('https://service.force.com');
	}
</script>
</body>
</html>
